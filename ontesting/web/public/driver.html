<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöô Driver Dashboard - PureRide</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #ffc107 0%, #ff8c00 100%); min-height: 100vh; }
        .container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
        .header { text-align: center; margin-bottom: 40px; color: white; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .back-btn { color: white; text-decoration: none; font-size: 1.1rem; margin-bottom: 20px; display: inline-block; }
        .back-btn:hover { text-decoration: underline; }
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .card { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .full-width { grid-column: 1 / -1; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1rem; transition: border-color 0.3s ease; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #ffc107; }
        .btn { background: linear-gradient(45deg, #ffc107, #ff8c00); color: white; border: none; padding: 12px 25px; border-radius: 50px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin: 5px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
        .btn-secondary { background: linear-gradient(45deg, #6c757d, #495057); }
        .status { padding: 15px; margin: 15px 0; border-radius: 10px; font-weight: 500; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat { text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px; }
        .stat-number { font-size: 1.5rem; font-weight: bold; color: #ffc107; }
        .stat-label { font-size: 0.9rem; color: #666; }
        .online-status { display: inline-block; padding: 5px 15px; border-radius: 20px; font-weight: 600; font-size: 0.9rem; }
        .online { background: #28a745; color: white; }
        .offline { background: #dc3545; color: white; }
        .route-item { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 10px; border-left: 4px solid #ffc107; }
        .route-item h4 { color: #333; margin-bottom: 5px; }
        .route-item p { color: #666; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Back to Home</a>
        <div class="header">
            <h1>üöô Driver Dashboard</h1>
            <p>Maximize your earnings with smart routes</p>
        </div>

        <div class="dashboard">
            <div class="card">
                <h3>Driver Status</h3>
                <div class="form-group">
                    <label for="driverName">Driver Name</label>
                    <input type="text" id="driverName" placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label for="driverPhone">Phone Number</label>
                    <input type="tel" id="driverPhone" placeholder="Your phone number">
                </div>
                <div class="form-group">
                    <label for="vehicleType">Vehicle Type</label>
                    <select id="vehicleType">
                        <option value="">Select vehicle</option>
                        <option value="sedan">Sedan (4 seats)</option>
                        <option value="suv">SUV (6 seats)</option>
                        <option value="van">Van (8+ seats)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="currentLocation">Current Location</label>
                    <input type="text" id="currentLocation" placeholder="Enter your location">
                </div>
                <button class="btn" onclick="toggleOnlineStatus()">Go Online</button>
                <div id="driverStatus" class="online-status offline">Offline</div>
            </div>

            <div class="card">
                <h3>Today's Stats</h3>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-number" id="ridesCompleted">0</div>
                        <div class="stat-label">Rides</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="packagesDelivered">0</div>
                        <div class="stat-label">Packages</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="earnings">$0</div>
                        <div class="stat-label">Earnings</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="rating">5.0</div>
                        <div class="stat-label">Rating</div>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="getOptimizedRoute()">Get Smart Route</button>
                <button class="btn btn-secondary" onclick="viewEarnings()">View Earnings</button>
            </div>

            <div class="card full-width">
                <h3>Optimized Route</h3>
                <div id="routeInfo">
                    <p style="color: #666; text-align: center; padding: 20px;">Click "Get Smart Route" to see available rides and packages along your route.</p>
                </div>
            </div>
        </div>

        <div id="status"></div>
    </div>

    <script>
        let isOnline = false;
        let driverId = null;

        function toggleOnlineStatus() {
            const name = document.getElementById('driverName').value;
            const phone = document.getElementById('driverPhone').value;
            const vehicle = document.getElementById('vehicleType').value;
            const location = document.getElementById('currentLocation').value;

            if (!name || !phone || !vehicle || !location) {
                showStatus('‚ùå Please fill in all driver information first.', 'error');
                return;
            }

            if (!isOnline) {
                goOnline(name, phone, vehicle, location);
            } else {
                goOffline();
            }
        }

        async function goOnline(name, phone, vehicle, location) {
            driverId = name.replace(/\s+/g, '') + Date.now();
            
            const data = {
                driverId: driverId,
                name: name,
                phone: phone,
                vehicleType: vehicle,
                location: location,
                route: []
            };
            
            try {
                const response = await fetch('/api/driver/available', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                isOnline = true;
                document.querySelector('.btn').textContent = 'Go Offline';
                document.getElementById('driverStatus').textContent = 'Online';
                document.getElementById('driverStatus').className = 'online-status online';
                showStatus('‚úÖ You are now online and available for rides!', 'success');
            } catch (error) {
                showStatus('‚ùå Error going online. Please try again.', 'error');
            }
        }

        function goOffline() {
            isOnline = false;
            driverId = null;
            document.querySelector('.btn').textContent = 'Go Online';
            document.getElementById('driverStatus').textContent = 'Offline';
            document.getElementById('driverStatus').className = 'online-status offline';
            document.getElementById('routeInfo').innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">You are offline. Go online to see available routes.</p>';
            showStatus('You are now offline.', 'info');
        }

        async function getOptimizedRoute() {
            if (!isOnline || !driverId) {
                showStatus('‚ùå Please go online first to get routes.', 'error');
                return;
            }

            try {
                const response = await fetch(`/api/optimize-route/${driverId}`);
                const route = await response.json();
                
                displayRoute(route);
                showStatus(`üìç Route optimized: ${route.stops.length} stops, ${route.estimatedTime}, ${route.totalDistance}`, 'info');
            } catch (error) {
                showStatus('‚ùå Error getting route. Please try again.', 'error');
            }
        }

        function displayRoute(route) {
            const routeInfo = document.getElementById('routeInfo');
            
            if (route.stops.length === 0) {
                routeInfo.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No rides or packages available in your area right now. Check back soon!</p>';
                return;
            }

            let routeHTML = `
                <div style="margin-bottom: 15px;">
                    <strong>Route Summary:</strong> ${route.stops.length} stops ‚Ä¢ ${route.estimatedTime} ‚Ä¢ ${route.totalDistance}
                </div>
            `;

            route.stops.forEach((stop, index) => {
                const type = stop.pickup ? 'üöó Ride' : 'üì¶ Package';
                routeHTML += `
                    <div class="route-item">
                        <h4>Stop ${index + 1}: ${type}</h4>
                        <p><strong>Pickup:</strong> ${stop.pickup || 'N/A'}</p>
                        <p><strong>Dropoff:</strong> ${stop.dropoff || 'N/A'}</p>
                    </div>
                `;
            });

            routeInfo.innerHTML = routeHTML;
        }

        function viewEarnings() {
            showStatus('üí∞ Earnings feature coming soon! You\'ll be able to track daily, weekly, and monthly earnings here.', 'info');
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // Simulate some stats updates
        setInterval(() => {
            if (isOnline) {
                const rides = Math.floor(Math.random() * 10);
                const packages = Math.floor(Math.random() * 15);
                const earnings = (rides * 12 + packages * 5).toFixed(0);
                
                document.getElementById('ridesCompleted').textContent = rides;
                document.getElementById('packagesDelivered').textContent = packages;
                document.getElementById('earnings').textContent = '$' + earnings;
            }
        }, 30000);
    </script>
</body>
</html>