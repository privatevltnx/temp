<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FixMitra Provider Portal - Premium Service Management Dashboard</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="img/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="manifest" href="img/site.webmanifest">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="FixMitra Provider Portal - Manage your home service business with our premium dashboard. Accept requests, track services, communicate with customers, and grow your business.">
    <meta name="keywords" content="home services, provider dashboard, service management, FixMitra, home repair, maintenance services, business management">
    <meta name="author" content="FixMitra">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="FixMitra Provider Portal - Premium Service Management">
    <meta property="og:description" content="Manage your home service business with FixMitra's premium provider dashboard. Accept requests, track services, and grow your business.">
    <meta property="og:image" content="img/og-image-provider.png">
    <meta property="og:url" content="https://fixmitra.com/provider">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="FixMitra">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="FixMitra Provider Portal - Premium Service Management">
    <meta name="twitter:description" content="Manage your home service business with FixMitra's premium provider dashboard.">
    <meta name="twitter:image" content="img/twitter-card-provider.png">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#6366f1">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --glass: rgba(255, 255, 255, 0.1);
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
            --shadow-xl: 0 20px 50px rgba(0,0,0,0.2);
            --radius: 16px;
            --transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
        }
        
        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .btn-premium {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 0.75rem 2rem;
            border-radius: var(--radius);
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .btn-premium::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-premium:hover::before {
            left: 100%;
        }
        
        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }
        
        .nav-item {
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .nav-item:hover {
            background: rgba(99, 102, 241, 0.1);
            transform: translateX(4px);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-accepted { background: #d1fae5; color: #065f46; }
        .status-rejected { background: #fee2e2; color: #991b1b; }
        .status-completed { background: #dbeafe; color: #1e40af; }
        
        .floating-element {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-ring {
            animation: pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite;
        }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(2.4); opacity: 0; }
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .brand-logo {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ffffff, #e2e8f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .notification-dot {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @media (max-width: 768px) {
            .glass-card { margin: 0.5rem; }
            .btn-premium { padding: 0.5rem 1.5rem; }
            .brand-logo { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div id="authSection" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md">
            <!-- Brand Header -->
            <div class="text-center mb-8 fade-in">
                <div class="brand-logo mb-2">FixMitra</div>
                <p class="text-white/80 text-lg font-medium">Provider Portal</p>
                <p class="text-white/60 text-sm">Premium Service Management Platform</p>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="glass-card p-8 slide-in">
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold gradient-text mb-2">Welcome Back</h3>
                    <p class="text-gray-600">Sign in to your provider account</p>
                </div>
                
                <form onsubmit="loginProvider(event)" class="space-y-6">
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700">Email Address</label>
                        <div class="relative">
                            <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="email" id="loginEmail" required 
                                class="w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-gray-700">Password</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="password" id="loginPassword" required 
                                class="w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                        </div>
                    </div>
                    
                    <button type="submit" id="providerLoginBtn" class="w-full btn-premium py-3 text-lg font-semibold">
                        <i class="fas fa-sign-in-alt mr-2"></i>
                        Sign In
                    </button>
                </form>
                
                <div class="mt-6 text-center">
                    <button onclick="showRegisterForm()" class="text-indigo-600 hover:text-indigo-800 font-medium transition-colors">
                        New provider? Join FixMitra →
                    </button>
                </div>
            </div>

            <!-- Registration Form -->
            <div id="registerForm" class="glass-card p-8 hidden slide-in">
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold gradient-text mb-2">Join FixMitra</h3>
                    <p class="text-gray-600">Become a premium service provider</p>
                </div>
                
                <form onsubmit="registerProvider(event)" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Company Name</label>
                            <input type="text" id="companyName" required 
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Your Name</label>
                            <input type="text" id="providerName" required 
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Service Areas (Pincodes)</label>
                        <input type="text" id="pincodes" required placeholder="e.g., 682001, 682002, 682003" 
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Service Categories</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="flex items-center p-3 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                <input type="checkbox" name="categories" value="Home Cleaning" class="mr-3 w-4 h-4 text-indigo-600">
                                <span class="text-sm font-medium">Home Cleaning</span>
                            </label>
                            <label class="flex items-center p-3 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                <input type="checkbox" name="categories" value="AC Repair" class="mr-3 w-4 h-4 text-indigo-600">
                                <span class="text-sm font-medium">AC Repair</span>
                            </label>
                            <label class="flex items-center p-3 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                <input type="checkbox" name="categories" value="Plumbing" class="mr-3 w-4 h-4 text-indigo-600">
                                <span class="text-sm font-medium">Plumbing</span>
                            </label>
                            <label class="flex items-center p-3 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                <input type="checkbox" name="categories" value="Electrical Work" class="mr-3 w-4 h-4 text-indigo-600">
                                <span class="text-sm font-medium">Electrical Work</span>
                            </label>
                            <label class="flex items-center p-3 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                <input type="checkbox" name="categories" value="Painting" class="mr-3 w-4 h-4 text-indigo-600">
                                <span class="text-sm font-medium">Painting</span>
                            </label>
                            <label class="flex items-center p-3 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                <input type="checkbox" name="categories" value="Appliance Repair" class="mr-3 w-4 h-4 text-indigo-600">
                                <span class="text-sm font-medium">Appliance Repair</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="providerPhone" required 
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">GSTIN (Optional)</label>
                            <input type="text" id="gstin" 
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
                        <input type="email" id="registerEmail" required 
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Password</label>
                            <input type="password" id="registerPassword" required 
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Confirm Password</label>
                            <input type="password" id="confirmPassword" required 
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                        </div>
                    </div>
                    
                    <button type="submit" id="providerRegisterBtn" class="w-full btn-premium py-3 text-lg font-semibold mt-6">
                        <i class="fas fa-user-plus mr-2"></i>
                        Join FixMitra Network
                    </button>
                </form>
                
                <div class="mt-6 text-center">
                    <button onclick="showLoginForm()" class="text-indigo-600 hover:text-indigo-800 font-medium transition-colors">
                        ← Back to Sign In
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboardSection" class="hidden min-h-screen">
        <!-- Header -->
        <header class="glass-card m-4 mb-0 relative z-10">
            <div class="px-4 md:px-6 py-3 md:py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <div class="floating-element">
                            <img src="img/logo-icon.png" alt="FixMitra" class="w-8 h-8 md:w-12 md:h-12 rounded-xl shadow-lg">
                        </div>
                        <div>
                            <h1 class="text-lg md:text-2xl font-bold gradient-text">FixMitra</h1>
                            <p class="text-gray-600 text-xs md:text-sm font-medium hidden md:block">Provider Dashboard</p>
                            <span class="md:hidden text-xs font-medium text-orange-500 bg-orange-50 px-2 py-1 rounded-full inline-block">Provider</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <!-- Notifications -->
                        <div class="relative">
                            <button onclick="toggleNotifications()" class="relative p-2 md:p-3 bg-gray-100 hover:bg-gray-200 rounded-lg md:rounded-xl transition-all duration-300 group">
                                <i class="fas fa-bell text-sm md:text-base text-gray-600 group-hover:text-indigo-600 transition-colors"></i>
                                <span id="notificationBadge" class="notification-dot hidden"></span>
                            </button>
                            
                            <div id="notificationPanel" class="absolute right-0 top-full mt-2 w-72 md:w-80 glass-card z-[9999] hidden shadow-2xl">
                                <div class="p-3 md:p-4 border-b border-gray-200">
                                    <h3 class="font-bold text-gray-800 flex items-center text-sm md:text-base">
                                        <i class="fas fa-bell mr-2 text-indigo-600"></i>
                                        Notifications
                                    </h3>
                                </div>
                                <div id="notificationList" class="max-h-60 overflow-y-auto p-3 md:p-4">
                                    <p class="text-gray-500 text-center py-4 text-sm">No notifications</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profile -->
                        <div class="hidden md:flex items-center space-x-3 bg-gray-100 rounded-xl px-4 py-2">
                            <div class="w-8 h-8 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                                <i class="fas fa-user text-white text-sm"></i>
                            </div>
                            <span id="providerName" class="font-semibold text-gray-800"></span>
                        </div>
                        
                        <!-- Mobile Profile -->
                        <div class="md:hidden w-8 h-8 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center" >
                            <i class="fas fa-user text-white text-sm"></i>
                        </div>
                        
                        <!-- Logout -->
                        <button onclick="logout()" class="p-2 md:p-3 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg md:rounded-xl transition-all duration-300 group">
                            <i class="fas fa-sign-out-alt text-sm md:text-base group-hover:scale-110 transition-transform"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto p-4">
            <!-- Mobile Navigation -->
            <div class="md:hidden mb-6">
                <div class="glass-card p-4">
                    <nav class="grid grid-cols-4 gap-2">
                        <button onclick="showSection('requests')" class="nav-item active flex flex-col items-center py-3 text-center">
                            <i class="fas fa-clipboard-list text-xl mb-2"></i>
                            <span class="text-xs font-semibold">Requests</span>
                        </button>
                        <button onclick="showSection('chats')" class="nav-item flex flex-col items-center py-3 text-center text-gray-600">
                            <i class="fas fa-comments text-xl mb-2"></i>
                            <span class="text-xs font-semibold">Chats</span>
                        </button>
                        <button onclick="showSection('overall')" class="nav-item flex flex-col items-center py-3 text-center text-gray-600">
                            <i class="fas fa-chart-bar text-xl mb-2"></i>
                            <span class="text-xs font-semibold">Analytics</span>
                        </button>
                        <button onclick="showSection('profile')" class="nav-item flex flex-col items-center py-3 text-center text-gray-600">
                            <i class="fas fa-user text-xl mb-2"></i>
                            <span class="text-xs font-semibold">Profile</span>
                        </button>
                    </nav>
                </div>
            </div>
            
            <div class="flex gap-6">
                <!-- Sidebar - Desktop -->
                <div class="hidden md:block w-72">
                    <div class="glass-card p-6 sticky top-4">
                        <div class="mb-6">
                            <h2 class="text-lg font-bold text-gray-800 mb-2">Navigation</h2>
                            <div class="w-12 h-1 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full"></div>
                        </div>
                        
                        <nav class="space-y-2">
                            <button onclick="showSection('requests')" class="nav-item active w-full text-left flex items-center">
                                <i class="fas fa-clipboard-list mr-3 text-lg"></i>
                                <span class="font-semibold">Service Requests</span>
                            </button>
                            <button onclick="showSection('chats')" class="nav-item w-full text-left flex items-center text-gray-600">
                                <i class="fas fa-comments mr-3 text-lg"></i>
                                <span class="font-semibold">Customer Chats</span>
                            </button>
                            <button onclick="showSection('overall')" class="nav-item w-full text-left flex items-center text-gray-600">
                                <i class="fas fa-chart-bar mr-3 text-lg"></i>
                                <span class="font-semibold">Analytics</span>
                            </button>
                            <button onclick="showSection('profile')" class="nav-item w-full text-left flex items-center text-gray-600">
                                <i class="fas fa-user mr-3 text-lg"></i>
                                <span class="font-semibold">Profile Settings</span>
                            </button>
                        </nav>
                        
                        <div class="mt-8 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border border-indigo-100">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-star text-yellow-500 mr-2"></i>
                                <span class="font-semibold text-gray-800">Premium Provider</span>
                            </div>
                            <p class="text-sm text-gray-600">You're part of FixMitra's premium network</p>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="flex-1 min-w-0">
                    <!-- Requests Section -->
                    <div id="requestsSection" class="section fade-in">
                        <!-- Pending Requests -->
                        <div class="glass-card p-4 md:p-6 mb-4 md:mb-6">
                            <div class="flex items-center justify-between mb-4 md:mb-6">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 md:w-12 md:h-12 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-lg md:rounded-xl flex items-center justify-center mr-3 md:mr-4 floating-element">
                                        <i class="fas fa-clock text-white text-sm md:text-lg"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-lg md:text-xl font-bold text-gray-800">Pending Requests</h2>
                                        <p class="text-gray-600 text-xs md:text-sm hidden md:block">New service requests awaiting your response</p>
                                    </div>
                                </div>
                                <div class="pulse-ring w-2 h-2 md:w-3 md:h-3 bg-yellow-400 rounded-full"></div>
                            </div>
                            <div id="pendingRequests" class="space-y-3 md:space-y-4"></div>
                        </div>
                        
                        <!-- Accepted Requests -->
                        <div class="glass-card p-4 md:p-6 mb-4 md:mb-6">
                            <div class="flex items-center justify-between mb-4 md:mb-6">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 md:w-12 md:h-12 bg-gradient-to-r from-green-400 to-emerald-500 rounded-lg md:rounded-xl flex items-center justify-center mr-3 md:mr-4">
                                        <i class="fas fa-check text-white text-sm md:text-lg"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-lg md:text-xl font-bold text-gray-800">Active Services</h2>
                                        <p class="text-gray-600 text-xs md:text-sm hidden md:block">Services you've accepted and are working on</p>
                                    </div>
                                </div>
                                <div class="w-2 h-2 md:w-3 md:h-3 bg-green-400 rounded-full animate-pulse"></div>
                            </div>
                            <div id="acceptedRequests" class="space-y-3 md:space-y-4"></div>
                        </div>
                        
                        <!-- Rejected Requests -->
                        <div class="glass-card p-4 md:p-6">
                            <div class="flex items-center mb-4 md:mb-6">
                                <div class="w-8 h-8 md:w-12 md:h-12 bg-gradient-to-r from-red-400 to-pink-500 rounded-lg md:rounded-xl flex items-center justify-center mr-3 md:mr-4">
                                    <i class="fas fa-times text-white text-sm md:text-lg"></i>
                                </div>
                                <div>
                                    <h2 class="text-lg md:text-xl font-bold text-gray-800">Declined Services</h2>
                                    <p class="text-gray-600 text-xs md:text-sm hidden md:block">Services you've declined or couldn't take</p>
                                </div>
                            </div>
                            <div id="rejectedRequests" class="space-y-3 md:space-y-4"></div>
                        </div>
                    </div>

                    <!-- Chats Section -->
                    <div id="chatsSection" class="section hidden fade-in">
                        <div class="glass-card p-6">
                            <div class="flex items-center mb-6">
                                <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mr-4">
                                    <i class="fas fa-comments text-white text-lg"></i>
                                </div>
                                <div>
                                    <h2 class="text-xl font-bold text-gray-800">Customer Communications</h2>
                                    <p class="text-gray-600 text-sm">Chat with your active customers</p>
                                </div>
                            </div>
                            <div id="chatsList" class="space-y-4"></div>
                        </div>
                        
                        <!-- Chat Window -->
                        <div id="chatWindow" class="glass-card p-6 mt-6 hidden">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-lg font-bold text-gray-800">Chat with Customer</h3>
                                <button onclick="closeChatWindow()" class="p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                                    <i class="fas fa-times text-gray-600"></i>
                                </button>
                            </div>
                            <div id="chatMessages" class="h-80 overflow-y-auto bg-gray-50 rounded-xl p-4 mb-4 border border-gray-200"></div>
                            <div class="flex gap-3">
                                <input type="text" id="messageInput" placeholder="Type your message..." 
                                    class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all" 
                                    onkeypress="handleMessageKeyPress(event)">
                                <button onclick="sendMessage()" class="btn-premium px-6">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Section -->
                    <div id="overallSection" class="section hidden fade-in">
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
                            <div class="glass-card p-4 md:p-6 hover:scale-105 transition-all duration-300">
                                <div class="flex items-center justify-between mb-3 md:mb-4">
                                    <div class="w-8 h-8 md:w-12 md:h-12 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-lg md:rounded-xl flex items-center justify-center">
                                        <i class="fas fa-clock text-white text-sm md:text-lg"></i>
                                    </div>
                                    <div class="pulse-ring w-1 h-1 md:w-2 md:h-2 bg-yellow-400 rounded-full"></div>
                                </div>
                                <div>
                                    <p class="text-xs md:text-sm font-semibold text-gray-600 mb-1">Pending</p>
                                    <p id="pendingCount" class="text-xl md:text-3xl font-bold gradient-text">0</p>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 md:p-6 hover:scale-105 transition-all duration-300">
                                <div class="flex items-center justify-between mb-3 md:mb-4">
                                    <div class="w-8 h-8 md:w-12 md:h-12 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-lg md:rounded-xl flex items-center justify-center">
                                        <i class="fas fa-handshake text-white text-sm md:text-lg"></i>
                                    </div>
                                    <div class="w-1 h-1 md:w-2 md:h-2 bg-blue-400 rounded-full animate-pulse"></div>
                                </div>
                                <div>
                                    <p class="text-xs md:text-sm font-semibold text-gray-600 mb-1">Active</p>
                                    <p id="acceptedCount" class="text-xl md:text-3xl font-bold gradient-text">0</p>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 md:p-6 hover:scale-105 transition-all duration-300">
                                <div class="flex items-center justify-between mb-3 md:mb-4">
                                    <div class="w-8 h-8 md:w-12 md:h-12 bg-gradient-to-r from-red-400 to-pink-500 rounded-lg md:rounded-xl flex items-center justify-center">
                                        <i class="fas fa-times text-white text-sm md:text-lg"></i>
                                    </div>
                                </div>
                                <div>
                                    <p class="text-xs md:text-sm font-semibold text-gray-600 mb-1">Declined</p>
                                    <p id="rejectedCount" class="text-xl md:text-3xl font-bold gradient-text">0</p>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 md:p-6 hover:scale-105 transition-all duration-300">
                                <div class="flex items-center justify-between mb-3 md:mb-4">
                                    <div class="w-8 h-8 md:w-12 md:h-12 bg-gradient-to-r from-green-400 to-emerald-500 rounded-lg md:rounded-xl flex items-center justify-center">
                                        <i class="fas fa-trophy text-white text-sm md:text-lg"></i>
                                    </div>
                                    <div class="w-1 h-1 md:w-2 md:h-2 bg-green-400 rounded-full animate-pulse"></div>
                                </div>
                                <div>
                                    <p class="text-xs md:text-sm font-semibold text-gray-600 mb-1">Completed</p>
                                    <p id="completedCount" class="text-xl md:text-3xl font-bold gradient-text">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Performance Overview -->
                        <div class="glass-card p-4 md:p-8">
                            <div class="text-center mb-6 md:mb-8">
                                <h3 class="text-lg md:text-2xl font-bold gradient-text mb-2">Performance Overview</h3>
                                <p class="text-gray-600 text-sm md:text-base hidden md:block">Your service statistics at a glance</p>
                            </div>
                            
                            <div class="flex flex-col lg:flex-row items-center justify-center space-y-6 lg:space-y-0 lg:space-x-12">
                                <!-- Circle Chart -->
                                <div class="relative floating-element">
                                    <svg width="180" height="180" class="md:w-60 md:h-60 transform -rotate-90">
                                        <circle cx="90" cy="90" r="70" fill="none" stroke="#f1f5f9" stroke-width="15" class="md:cx-[120] md:cy-[120] md:stroke-[20]"/>
                                        <circle id="pendingCircle" cx="90" cy="90" r="70" fill="none" stroke="#f59e0b" stroke-width="15" stroke-dasharray="0 440" stroke-linecap="round" class="transition-all duration-1000 md:cx-[120] md:cy-[120] md:stroke-[20]"/>
                                        <circle id="acceptedCircle" cx="90" cy="90" r="70" fill="none" stroke="#3b82f6" stroke-width="15" stroke-dasharray="0 440" stroke-linecap="round" class="transition-all duration-1000 md:cx-[120] md:cy-[120] md:stroke-[20]"/>
                                        <circle id="rejectedCircle" cx="90" cy="90" r="70" fill="none" stroke="#ef4444" stroke-width="15" stroke-dasharray="0 440" stroke-linecap="round" class="transition-all duration-1000 md:cx-[120] md:cy-[120] md:stroke-[20]"/>
                                        <circle id="completedCircle" cx="90" cy="90" r="70" fill="none" stroke="#10b981" stroke-width="15" stroke-dasharray="0 440" stroke-linecap="round" class="transition-all duration-1000 md:cx-[120] md:cy-[120] md:stroke-[20]"/>
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <div class="text-center">
                                            <div id="totalCount" class="text-2xl md:text-4xl font-bold gradient-text">0</div>
                                            <div class="text-xs md:text-sm font-semibold text-gray-600">Total</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Legend -->
                                <div class="grid grid-cols-2 gap-3 md:gap-6">
                                    <div class="flex items-center space-x-2 md:space-x-3 p-2 md:p-3 bg-yellow-50 rounded-lg md:rounded-xl">
                                        <div class="w-3 h-3 md:w-4 md:h-4 rounded-full bg-yellow-500"></div>
                                        <span class="font-semibold text-gray-700 text-sm md:text-base">Pending</span>
                                    </div>
                                    <div class="flex items-center space-x-2 md:space-x-3 p-2 md:p-3 bg-blue-50 rounded-lg md:rounded-xl">
                                        <div class="w-3 h-3 md:w-4 md:h-4 rounded-full bg-blue-500"></div>
                                        <span class="font-semibold text-gray-700 text-sm md:text-base">Active</span>
                                    </div>
                                    <div class="flex items-center space-x-2 md:space-x-3 p-2 md:p-3 bg-red-50 rounded-lg md:rounded-xl">
                                        <div class="w-3 h-3 md:w-4 md:h-4 rounded-full bg-red-500"></div>
                                        <span class="font-semibold text-gray-700 text-sm md:text-base">Declined</span>
                                    </div>
                                    <div class="flex items-center space-x-2 md:space-x-3 p-2 md:p-3 bg-green-50 rounded-lg md:rounded-xl">
                                        <div class="w-3 h-3 md:w-4 md:h-4 rounded-full bg-green-500"></div>
                                        <span class="font-semibold text-gray-700 text-sm md:text-base">Completed</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Section -->
                    <div id="profileSection" class="section hidden fade-in">
                        <div class="glass-card p-8">
                            <div class="flex items-center mb-8">
                                <div class="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center mr-6">
                                    <i class="fas fa-user-cog text-white text-2xl"></i>
                                </div>
                                <div>
                                    <h2 class="text-2xl font-bold gradient-text">Profile Settings</h2>
                                    <p class="text-gray-600">Manage your provider information and preferences</p>
                                </div>
                            </div>
                            
                            <form onsubmit="updateProfile(event)" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">Company Name</label>
                                        <input type="text" id="profileCompanyName" 
                                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">Your Name</label>
                                        <input type="text" id="profileProviderName" 
                                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Service Areas (Pincodes)</label>
                                    <input type="text" id="profilePincodes" 
                                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-4">Service Categories</label>
                                    <div class="grid grid-cols-2 gap-4" id="profileCategories">
                                        <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                            <input type="checkbox" name="profileCats" value="Home Cleaning" class="mr-3 w-4 h-4 text-indigo-600">
                                            <span class="font-medium">Home Cleaning</span>
                                        </label>
                                        <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                            <input type="checkbox" name="profileCats" value="AC Repair" class="mr-3 w-4 h-4 text-indigo-600">
                                            <span class="font-medium">AC Repair</span>
                                        </label>
                                        <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                            <input type="checkbox" name="profileCats" value="Plumbing" class="mr-3 w-4 h-4 text-indigo-600">
                                            <span class="font-medium">Plumbing</span>
                                        </label>
                                        <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                            <input type="checkbox" name="profileCats" value="Electrical Work" class="mr-3 w-4 h-4 text-indigo-600">
                                            <span class="font-medium">Electrical Work</span>
                                        </label>
                                        <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                            <input type="checkbox" name="profileCats" value="Painting" class="mr-3 w-4 h-4 text-indigo-600">
                                            <span class="font-medium">Painting</span>
                                        </label>
                                        <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                            <input type="checkbox" name="profileCats" value="Appliance Repair" class="mr-3 w-4 h-4 text-indigo-600">
                                            <span class="font-medium">Appliance Repair</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="mt-6">
                                    <label class="block text-sm font-semibold text-gray-700 mb-4">Notification Preferences</label>
                                    <div class="space-y-3">
                                        <label class="flex items-center justify-between p-4 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                            <div class="flex items-center">
                                                <i class="fas fa-envelope mr-3 text-indigo-600"></i>
                                                <span class="font-medium">Email Notifications</span>
                                            </div>
                                            <input type="checkbox" id="emailNotifications" class="w-5 h-5 text-indigo-600">
                                        </label>
                                        <label class="flex items-center justify-between p-4 border-2 border-gray-200 rounded-xl hover:border-indigo-300 transition-colors cursor-pointer">
                                            <div class="flex items-center">
                                                <i class="fab fa-whatsapp mr-3 text-green-600"></i>
                                                <span class="font-medium">WhatsApp Notifications</span>
                                            </div>
                                            <input type="checkbox" id="whatsappNotifications" class="w-5 h-5 text-indigo-600">
                                        </label>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn-premium">
                                    <i class="fas fa-save mr-2"></i>
                                    Update Profile
                                </button>
                            </form>
                            
                            <div class="mt-8 pt-8 border-t border-gray-200">
                                <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                                    <h3 class="text-lg font-bold text-red-800 mb-2">Danger Zone</h3>
                                    <p class="text-red-600 text-sm mb-4">This action cannot be undone. Please be certain.</p>
                                    <button onclick="deleteAccount()" class="px-6 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors font-semibold">
                                        <i class="fas fa-trash mr-2"></i>
                                        Delete Account
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Premium Modals -->
    <div id="premiumModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="glass-card max-w-md w-full mx-4 p-6 text-center">
            <div id="modalIcon" class="w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center"></div>
            <h3 id="modalTitle" class="text-xl font-bold mb-2"></h3>
            <p id="modalMessage" class="text-gray-600 mb-6"></p>
            <div id="modalButtons" class="space-y-3"></div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const supabaseUrl = 'https://imdrjtjlpuqdixvpdytk.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltZHJqdGpscHVxZGl4dnBkeXRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwMzExMTcsImV4cCI6MjA3MTYwNzExN30.Sa8UFkFyLKTL-JLzaojq9whdq3VjHFqxSVlWY_W4HkU';
        const { createClient } = supabase;
        const supabaseClient = createClient(supabaseUrl, supabaseKey);

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB3brs9fwpmiJemKQ2fxotB4A-cHM3J_8o",
            authDomain: "my-chat-app-890.firebaseapp.com",
            databaseURL: "https://my-chat-app-890-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "my-chat-app-890",
            storageBucket: "my-chat-app-890.firebasestorage.app",
            messagingSenderId: "493505638473",
            appId: "1:493505638473:web:dcee0e34eb948f9448cf98",
            measurementId: "G-K7M6M0E5BF"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        let currentProvider = null;
        let currentChatId = null;
        let unsubscribeChat = null;
        let isLoggedIn = localStorage.getItem('providerLoggedIn') === 'true';
        let providerData = JSON.parse(localStorage.getItem('providerData') || '{}');

        // Initialize EmailJS
        emailjs.init('UCB-e8RJIwpvJYao-');
        
        // Notification functions
        async function sendWhatsAppNotification(phone, requestData) {
            const message = `🔔 *FixMitra - New Service Request*\n\n` +
                          `*Action Required:* A new service request has been created in your locality.\n\n` +
                          `*Request Details:*\n` +
                          `• Service: ${requestData.category}\n` +
                          `• Location: Pincode ${requestData.pincode}\n` +
                          `• Request Time: ${new Date(requestData.created_at).toLocaleString()}\n` +
                          `• Request ID: #${requestData.request_id}\n` +
                          `• Provider Selection: ${requestData.provider === 'default' ? 'Default' : 'Custom'}\n\n` +
                          `A customer in your service area needs assistance. Please review and respond promptly.\n\n` +
                          `*Quick Actions:*\n` +
                          `✓ Review request details\n` +
                          `✓ Accept or decline service\n` +
                          `✓ Contact customer if accepted\n\n` +
                          `Open Provider Dashboard: ${window.location.origin}/provider.fixmitra/`;
            
            const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
            // In production, use WhatsApp Business API
            console.log('WhatsApp notification:', whatsappUrl);
        }
        
        async function sendEmailNotification(email, requestData) {
            try {
                const templateParams = {
                    to_email: email,
                    service_category: requestData.category,
                    location: `Pincode: ${requestData.pincode}`,
                    request_time: new Date(requestData.created_at).toLocaleString(),
                    request_id: requestData.request_id,
                    provider_selection: requestData.provider === 'default' ? 'Default' : 'Custom',
                    dashboard_url: window.location.origin + '/provider.fixmitra/'
                };
                
                await emailjs.send('service_vgfcxqo', 'template_8thkh7e', templateParams);
                console.log('Email notification sent successfully');
            } catch (error) {
                console.error('Email notification failed:', error);
            }
        }
        
        async function notifyProvidersOfNewRequest(requestData) {
            try {
                const { data: providers, error } = await supabaseClient
                    .from('providers')
                    .select('*')
                    .eq('status', 'active');
                
                if (error) throw error;
                
                const matchingProviders = providers.filter(provider => {
                    const providerPincodes = provider.pincodes.split(',').map(p => p.trim());
                    const providerCategories = provider.categories.split(',').map(c => c.trim());
                    return providerPincodes.includes(requestData.pincode) && 
                           providerCategories.includes(requestData.category);
                });
                
                const message = `New request was created in your locality. Service: ${requestData.category}. Open the web for next steps: ${window.location.origin}/provider.fixmitra/`;
                
                matchingProviders.forEach(async (provider) => {
                    if (provider.whatsapp_notifications) {
                        await sendWhatsAppNotification(provider.phone, message);
                    }
                    if (provider.email_notifications) {
                        await sendEmailNotification(provider.email, requestData);
                    }
                });
                
            } catch (error) {
                console.error('Error notifying providers:', error);
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            if (isLoggedIn && providerData.email) {
                currentProvider = providerData;
                showDashboard();
                loadRequests();
                checkProviderWarnings();
                setInterval(checkProviderWarnings, 300000); // Check every 5 minutes
            } else {
                showAuth();
            }
        });

        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        function showAuth() {
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            document.getElementById('providerName').textContent = currentProvider.name || currentProvider.email;
            loadProfileData();
        }

        async function loginProvider(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('providerLoginBtn');

            // Set loading state
            setButtonLoading(loginBtn, true, 'Signing In...');

            try {
                // Check provider in Supabase
                const { data, error } = await supabaseClient
                    .from('providers')
                    .select('*')
                    .eq('email', email)
                    .single();

                if (error || !data) {
                    alert('Invalid credentials');
                    return;
                }

                // Simple password check (in production, use proper hashing)
                if (data.password !== password) {
                    alert('Invalid credentials');
                    return;
                }

                currentProvider = data;
                isLoggedIn = true;
                localStorage.setItem('providerLoggedIn', 'true');
                localStorage.setItem('providerData', JSON.stringify(data));

                showDashboard();
                loadRequests();
                console.log('Login successful!');

            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. Please try again.');
            } finally {
                setButtonLoading(loginBtn, false, 'Sign In');
            }
        }

        async function registerProvider(event) {
            event.preventDefault();
            
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('providerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const registerBtn = document.getElementById('providerRegisterBtn');

            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            const categories = Array.from(document.querySelectorAll('input[name="categories"]:checked'))
                .map(cb => cb.value);

            if (categories.length === 0) {
                alert('Please select at least one service category');
                return;
            }

            // Set loading state
            setButtonLoading(registerBtn, true, 'Creating Account...');

            try {
                // Check if email already exists
                const { data: existingEmail, error: emailError } = await supabaseClient
                    .from('providers')
                    .select('email')
                    .eq('email', email)
                    .single();

                if (existingEmail) {
                    throw new Error('Email already registered. Please use a different email.');
                }

                // Check if phone already exists
                const { data: existingPhone, error: phoneError } = await supabaseClient
                    .from('providers')
                    .select('phone')
                    .eq('phone', phone)
                    .single();

                if (existingPhone) {
                    throw new Error('Phone number already registered. Please use a different phone number.');
                }

                const providerData = {
                    company_name: document.getElementById('companyName').value,
                    name: document.getElementById('providerName').value,
                    pincodes: document.getElementById('pincodes').value,
                    categories: categories.join(','),
                    phone: phone,
                    email: email,
                    password: password,
                    gstin: document.getElementById('gstin').value || null,
                    status: 'active'
                };

                const { data, error } = await supabaseClient
                    .from('providers')
                    .insert([providerData]);

                if (error) {
                    console.error('Registration error:', error);
                    throw new Error('Registration failed. Please try again.');
                }

                alert('Registration successful! Please login.');
                showLoginForm();

            } catch (error) {
                console.error('Registration error:', error);
                alert(error.message);
            } finally {
                setButtonLoading(registerBtn, false, 'Register as Provider');
            }
        }

        async function loadRequests() {
            if (!currentProvider || currentProvider.status !== 'active') return;

            try {
                const providerPincodes = currentProvider.pincodes.split(',').map(p => p.trim());
                const providerCategories = currentProvider.categories.split(',').map(c => c.trim());

                // Load requests matching provider's pincodes and categories
                const { data, error } = await supabaseClient
                    .from('requests')
                    .select('*')
                    .in('pincode', providerPincodes)
                    .in('category', providerCategories);

                if (error) throw error;

                const requests = data || [];
                console.log('Fetched requests:', requests);
                console.log('Provider pincodes:', providerPincodes);
                console.log('Provider categories:', providerCategories);
                
                // Filter requests based on provider assignment
                const pending = requests.filter(r => 
                    r.status === 'Pending' && 
                    (r.provider === 'default' || r.provider.includes(currentProvider.email))
                );
                const accepted = requests.filter(r => 
                    r.status === 'Accepted' && 
                    r.provider === currentProvider.email
                );
                const rejected = requests.filter(r => 
                    r.status === 'Rejected' && 
                    r.provider === currentProvider.email
                );
                const completed = requests.filter(r => 
                    r.status === 'Completed' && 
                    r.provider === currentProvider.email
                );

                renderPendingRequests(pending);
                renderAcceptedRequests(accepted);
                renderRejectedRequests(rejected);
                updateStats(pending.length, accepted.length, rejected.length, completed.length);

            } catch (error) {
                console.error('Error loading requests:', error);
            }
        }

        function renderPendingRequests(requests) {
            const container = document.getElementById('pendingRequests');
            container.innerHTML = '';

            if (requests.length === 0) {
                container.innerHTML = '<div class="text-center py-6 md:py-8"><i class="fas fa-inbox text-2xl md:text-4xl text-gray-300 mb-2 md:mb-4"></i><p class="text-gray-500 font-medium text-sm md:text-base">No pending requests</p></div>';
                return;
            }

            requests.forEach(request => {
                const card = document.createElement('div');
                card.className = 'glass-card p-4 md:p-6 hover:scale-102 transition-all duration-300';
                card.innerHTML = `
                    <div class="flex flex-col md:flex-row md:justify-between md:items-start space-y-3 md:space-y-0">
                        <div class="flex-1">
                            <div class="flex items-center mb-2 md:mb-3">
                                <div class="w-8 h-8 md:w-10 md:h-10 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-tools text-white text-xs md:text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800 text-sm md:text-base">${request.category}</h3>
                                    <p class="text-xs md:text-sm text-gray-500">Request #${request.request_id}</p>
                                </div>
                            </div>
                            <div class="space-y-1 text-xs md:text-sm text-gray-600">
                                <p><i class="fas fa-map-marker-alt mr-2 text-indigo-500"></i>Pincode: ${request.pincode}</p>
                                <p><i class="fas fa-user mr-2 text-indigo-500"></i>Customer: ${request.customer_name}</p>
                            </div>
                        </div>
                        <div class="flex space-x-2 md:space-x-3">
                            <button onclick="acceptRequest('${request.request_id}')" class="flex-1 md:flex-none px-3 md:px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-colors text-xs md:text-sm">
                                <i class="fas fa-check mr-1"></i>Accept
                            </button>
                            <button onclick="rejectRequest('${request.request_id}')" class="flex-1 md:flex-none px-3 md:px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold transition-colors text-xs md:text-sm">
                                <i class="fas fa-times mr-1"></i>Decline
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderAcceptedRequests(requests) {
            const container = document.getElementById('acceptedRequests');
            container.innerHTML = '';

            if (requests.length === 0) {
                container.innerHTML = '<div class="text-center py-6 md:py-8"><i class="fas fa-handshake text-2xl md:text-4xl text-gray-300 mb-2 md:mb-4"></i><p class="text-gray-500 font-medium text-sm md:text-base">No active services</p></div>';
                return;
            }

            requests.forEach(request => {
                const card = document.createElement('div');
                card.className = 'glass-card p-4 md:p-6 border-l-4 border-green-400 hover:scale-102 transition-all duration-300';
                card.innerHTML = `
                    <div class="flex flex-col md:flex-row md:justify-between md:items-start space-y-3 md:space-y-0">
                        <div class="flex-1">
                            <div class="flex items-center mb-2 md:mb-3">
                                <div class="w-8 h-8 md:w-10 md:h-10 bg-gradient-to-r from-green-400 to-emerald-500 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-cog fa-spin text-white text-xs md:text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800 text-sm md:text-base">${request.category}</h3>
                                    <span class="status-badge status-accepted text-xs">Active Service</span>
                                </div>
                            </div>
                            <div class="space-y-1 md:space-y-2 text-xs md:text-sm text-gray-600">
                                <p><i class="fas fa-hashtag mr-2 text-indigo-500"></i>ID: ${request.request_id}</p>
                                <p><i class="fas fa-user mr-2 text-indigo-500"></i>Customer: ${request.customer_name}</p>
                                <p><i class="fas fa-phone mr-2 text-indigo-500"></i>Phone: ${request.phone}</p>
                                <p><i class="fas fa-map-marker-alt mr-2 text-indigo-500"></i>Address: ${request.address}</p>
                            </div>
                        </div>
                        <div class="flex md:flex-col space-x-2 md:space-x-0 md:space-y-2">
                            <button onclick="completeRequest('${request.request_id}')" class="flex-1 md:flex-none px-3 md:px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-colors text-xs md:text-sm">
                                <i class="fas fa-check-circle mr-1"></i>Complete
                            </button>
                            <button onclick="cancelRequest('${request.request_id}')" class="flex-1 md:flex-none px-3 md:px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors text-xs md:text-sm">
                                <i class="fas fa-ban mr-1"></i>Cancel
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderRejectedRequests(requests) {
            const container = document.getElementById('rejectedRequests');
            container.innerHTML = '';

            if (requests.length === 0) {
                container.innerHTML = '<div class="text-center py-8"><i class="fas fa-times-circle text-4xl text-gray-300 mb-4"></i><p class="text-gray-500 font-medium">No declined services</p></div>';
                return;
            }

            requests.forEach(request => {
                const card = document.createElement('div');
                card.className = 'glass-card p-6 bg-red-50 border-l-4 border-red-400 opacity-75';
                card.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-red-400 to-pink-500 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-times text-white text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-gray-800">${request.category}</h3>
                            <div class="flex items-center space-x-4 text-sm text-gray-600 mt-1">
                                <span><i class="fas fa-hashtag mr-1"></i>ID: ${request.request_id}</span>
                                <span><i class="fas fa-map-marker-alt mr-1"></i>Pincode: ${request.pincode}</span>
                                <span class="status-badge status-rejected">Declined</span>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        async function acceptRequest(requestId) {
            try {
                const { error } = await supabaseClient
                    .from('requests')
                    .update({ 
                        status: 'Accepted',
                        provider: currentProvider.email,
                        accepted_by: currentProvider.name
                    })
                    .eq('request_id', parseInt(requestId))
                    .eq('status', 'Pending');

                if (error) throw error;

                showSuccessModal('Request Accepted!', 'You have successfully accepted this service request. The customer will be notified.');
                loadRequests();

            } catch (error) {
                console.error('Error accepting request:', error);
                showErrorModal('Failed to Accept', 'Unable to accept the request. Please try again.');
                loadRequests();
            }
        }

        async function rejectRequest(requestId) {
            showConfirmModal(
                'Decline Request?', 
                'Are you sure you want to decline this service request? It will be offered to other providers.',
                async () => {
                    try {
                        const { error } = await supabaseClient
                            .from('requests')
                            .update({ 
                                status: 'Rejected',
                                provider: currentProvider.email
                            })
                            .eq('request_id', parseInt(requestId));

                        if (error) throw error;

                        showDeclineModal('Request Declined', 'You have declined this service request. It will be offered to other providers.');
                        loadRequests();

                    } catch (error) {
                        console.error('Error rejecting request:', error);
                        showErrorModal('Failed to Decline', 'Unable to decline the request. Please try again.');
                    }
                }
            );
        }

        async function completeRequest(requestId) {
            try {
                const { error } = await supabaseClient
                    .from('requests')
                    .update({ status: 'Completed' })
                    .eq('request_id', parseInt(requestId));

                if (error) throw error;

                alert('Request marked as completed!');
                loadRequests();

            } catch (error) {
                console.error('Error completing request:', error);
                alert('Failed to complete request');
            }
        }

        async function cancelRequest(requestId) {
            showConfirmModal(
                'Cancel Service?', 
                'Are you sure you want to cancel this service? This action cannot be undone and the customer will be notified.',
                async () => {
                    try {
                        const { error } = await supabaseClient
                            .from('requests')
                            .update({ status: 'Provider Cancelled' })
                            .eq('request_id', parseInt(requestId));

                        if (error) throw error;

                        showCancelModal('Service Cancelled', 'The service has been cancelled. The customer has been notified.');
                        loadRequests();

                    } catch (error) {
                        console.error('Error cancelling request:', error);
                        showErrorModal('Failed to Cancel', 'Unable to cancel the service. Please try again.');
                    }
                }
            );
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });

            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('text-gray-600');
            });

            // Show selected section
            document.getElementById(sectionName + 'Section').classList.remove('hidden');

            // Add active class to clicked nav button
            const navButtons = document.querySelectorAll(`[onclick="showSection('${sectionName}')"]`);
            navButtons.forEach(btn => {
                btn.classList.add('active');
                btn.classList.remove('text-gray-600');
            });

            if (sectionName === 'requests') {
                loadRequests();
            } else if (sectionName === 'chats') {
                loadActiveChats();
            }
        }

        function updateStats(pending, accepted, rejected, completed) {
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('acceptedCount').textContent = accepted;
            document.getElementById('rejectedCount').textContent = rejected;
            document.getElementById('completedCount').textContent = completed;
            
            // Update circle chart
            updateStatsCircle(pending, accepted, rejected, completed);
        }
        
        function updateStatsCircle(pending, accepted, rejected, completed) {
            const total = pending + accepted + rejected + completed;
            document.getElementById('totalCount').textContent = total;
            
            if (total === 0) {
                // Reset all circles
                document.getElementById('pendingCircle').style.strokeDasharray = '0 440';
                document.getElementById('acceptedCircle').style.strokeDasharray = '0 440';
                document.getElementById('rejectedCircle').style.strokeDasharray = '0 440';
                document.getElementById('completedCircle').style.strokeDasharray = '0 440';
                return;
            }
            
            const circumference = 440; // 2 * π * 70
            let currentOffset = 0;
            
            // Pending
            const pendingLength = (pending / total) * circumference;
            document.getElementById('pendingCircle').style.strokeDasharray = `${pendingLength} ${circumference}`;
            document.getElementById('pendingCircle').style.strokeDashoffset = -currentOffset;
            currentOffset += pendingLength;
            
            // Accepted
            const acceptedLength = (accepted / total) * circumference;
            document.getElementById('acceptedCircle').style.strokeDasharray = `${acceptedLength} ${circumference}`;
            document.getElementById('acceptedCircle').style.strokeDashoffset = -currentOffset;
            currentOffset += acceptedLength;
            
            // Rejected
            const rejectedLength = (rejected / total) * circumference;
            document.getElementById('rejectedCircle').style.strokeDasharray = `${rejectedLength} ${circumference}`;
            document.getElementById('rejectedCircle').style.strokeDashoffset = -currentOffset;
            currentOffset += rejectedLength;
            
            // Completed
            const completedLength = (completed / total) * circumference;
            document.getElementById('completedCircle').style.strokeDasharray = `${completedLength} ${circumference}`;
            document.getElementById('completedCircle').style.strokeDashoffset = -currentOffset;
        }

        function loadProfileData() {
            if (currentProvider) {
                document.getElementById('profileCompanyName').value = currentProvider.company_name || '';
                document.getElementById('profileProviderName').value = currentProvider.name || '';
                document.getElementById('profilePincodes').value = currentProvider.pincodes || '';
                
                // Load categories
                const categories = currentProvider.categories ? currentProvider.categories.split(',') : [];
                document.querySelectorAll('input[name="profileCats"]').forEach(checkbox => {
                    checkbox.checked = categories.includes(checkbox.value);
                });
                
                // Load notification preferences
                document.getElementById('emailNotifications').checked = currentProvider.email_notifications || false;
                document.getElementById('whatsappNotifications').checked = currentProvider.whatsapp_notifications || false;
            }
        }

        async function updateProfile(event) {
            event.preventDefault();
            
            const categories = Array.from(document.querySelectorAll('input[name="profileCats"]:checked'))
                .map(cb => cb.value);

            if (categories.length === 0) {
                alert('Please select at least one service category');
                return;
            }
            
            const updatedData = {
                company_name: document.getElementById('profileCompanyName').value,
                name: document.getElementById('profileProviderName').value,
                pincodes: document.getElementById('profilePincodes').value,
                categories: categories.join(','),
                email_notifications: document.getElementById('emailNotifications').checked,
                whatsapp_notifications: document.getElementById('whatsappNotifications').checked
            };

            try {
                const { error } = await supabaseClient
                    .from('providers')
                    .update(updatedData)
                    .eq('email', currentProvider.email);

                if (error) throw error;

                // Update local data
                currentProvider = { ...currentProvider, ...updatedData };
                localStorage.setItem('providerData', JSON.stringify(currentProvider));

                alert('Profile updated successfully!');
                loadRequests(); // Reload requests with new categories

            } catch (error) {
                console.error('Error updating profile:', error);
                alert('Failed to update profile');
            }
        }

        function deleteAccount() {
            if (!confirm('Are you sure you want to delete your account? This action cannot be undone.')) return;
            if (!confirm('This will permanently delete all your data. Are you absolutely sure?')) return;

            // In production, implement proper account deletion
            alert('Account deletion feature will be implemented soon.');
        }

        async function loadActiveChats() {
            if (!currentProvider) return;
            
            try {
                const { data, error } = await supabaseClient
                    .from('requests')
                    .select('*')
                    .eq('status', 'Accepted')
                    .eq('provider', currentProvider.email);
                
                if (error) throw error;
                
                const chatsList = document.getElementById('chatsList');
                chatsList.innerHTML = '';
                
                if (data.length === 0) {
                    chatsList.innerHTML = '<p class="text-gray-500">No active chats</p>';
                    return;
                }
                
                data.forEach(request => {
                    const chatCard = document.createElement('div');
                    chatCard.className = 'border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer';
                    chatCard.onclick = () => openChatWindow(request.request_id, request.customer_name);
                    
                    chatCard.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-semibold">${request.customer_name}</h4>
                                <p class="text-sm text-gray-600">${request.category} - ${request.request_id}</p>
                            </div>
                            <div class="text-blue-600">
                                <i class="fas fa-comments"></i>
                            </div>
                        </div>
                    `;
                    
                    chatsList.appendChild(chatCard);
                });
                
            } catch (error) {
                console.error('Error loading chats:', error);
            }
        }
        
        function openChatWindow(requestId, customerName) {
            currentChatId = requestId;
            document.getElementById('chatWindow').classList.remove('hidden');
            document.querySelector('#chatWindow h3').textContent = `Chat with ${customerName}`;
            loadChatMessages();
        }
        
        function closeChatWindow() {
            document.getElementById('chatWindow').classList.add('hidden');
            if (unsubscribeChat) {
                unsubscribeChat();
                unsubscribeChat = null;
            }
            currentChatId = null;
        }
        
        function loadChatMessages() {
            if (!currentChatId) return;
            
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '<div class="text-center text-gray-500">Loading messages...</div>';
            
            // Listen for real-time messages
            unsubscribeChat = db.collection('chats').doc(String(currentChatId)).collection('messages')
                .orderBy('timestamp', 'asc')
                .onSnapshot((snapshot) => {
                    messagesContainer.innerHTML = '';
                    
                    snapshot.forEach((doc) => {
                        const message = doc.data();
                        const messageDiv = document.createElement('div');
                        messageDiv.className = `mb-3 ${message.sender === 'provider' ? 'text-right' : 'text-left'}`;
                        
                        const messageContent = document.createElement('div');
                        messageContent.className = `inline-block max-w-xs p-3 rounded-lg ${
                            message.sender === 'provider' 
                                ? 'bg-blue-500 text-white' 
                                : 'bg-gray-200 text-gray-800'
                        }`;
                        messageContent.textContent = message.text;
                        
                        const timestamp = document.createElement('div');
                        timestamp.className = 'text-xs text-gray-500 mt-1';
                        timestamp.textContent = new Date(message.timestamp?.toDate()).toLocaleTimeString();
                        
                        messageDiv.appendChild(messageContent);
                        messageDiv.appendChild(timestamp);
                        messagesContainer.appendChild(messageDiv);
                    });
                    
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                });
        }
        
        async function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message || !currentChatId) return;
            
            try {
                await db.collection('chats').doc(String(currentChatId)).collection('messages').add({
                    text: message,
                    sender: 'provider',
                    senderName: currentProvider.name,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                messageInput.value = '';
            } catch (error) {
                console.error('Error sending message:', error);
                alert('Failed to send message');
            }
        }
        
        function handleMessageKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function setButtonLoading(button, isLoading, text) {
            if (isLoading) {
                button.disabled = true;
                button.style.opacity = '0.7';
                button.style.cursor = 'not-allowed';
                button.innerHTML = `<i class="fas fa-spinner loading-spinner mr-2"></i>${text}`;
            } else {
                button.disabled = false;
                button.style.opacity = '1';
                button.style.cursor = 'pointer';
                button.innerHTML = text.includes('Sign In') ? `<i class="fas fa-sign-in-alt mr-2"></i>${text}` : 
                                 text.includes('Join') ? `<i class="fas fa-user-plus mr-2"></i>${text}` : text;
            }
        }

        async function checkProviderWarnings() {
            if (!currentProvider) return;

            try {
                const twoDaysAgo = new Date();
                twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
                const fourDaysAgo = new Date();
                fourDaysAgo.setDate(fourDaysAgo.getDate() - 4);

                const { data: pendingRequests, error } = await supabaseClient
                    .from('requests')
                    .select('*')
                    .eq('status', 'Pending');

                if (error) throw error;

                const providerPincodes = currentProvider.pincodes.split(',').map(p => p.trim());
                const providerCategories = currentProvider.categories.split(',').map(c => c.trim());

                const relevantRequests = pendingRequests.filter(request => {
                    return providerPincodes.includes(request.pincode) && 
                           providerCategories.includes(request.category) &&
                           (request.provider === 'default' || request.provider.includes(currentProvider.email));
                });

                const criticalRequests = relevantRequests.filter(r => new Date(r.created_at) < fourDaysAgo);
                const warningRequests = relevantRequests.filter(r => {
                    const requestDate = new Date(r.created_at);
                    return requestDate < twoDaysAgo && requestDate >= fourDaysAgo;
                });

                updateNotificationBadge(warningRequests.length, criticalRequests.length);

                if (criticalRequests.length > 0) {
                    showProviderWarning(criticalRequests.length, 'critical');
                } else if (warningRequests.length > 0) {
                    showProviderWarning(warningRequests.length, 'warning');
                }

            } catch (error) {
                console.error('Error checking provider warnings:', error);
            }
        }

        function updateNotificationBadge(warningCount, criticalCount) {
            const badge = document.getElementById('notificationBadge');
            
            if (criticalCount > 0) {
                badge.textContent = criticalCount;
                badge.className = 'absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1';
                badge.classList.remove('hidden');
            } else if (warningCount > 0) {
                badge.textContent = warningCount;
                badge.className = 'absolute -top-1 -right-1 bg-yellow-500 text-white text-xs rounded-full px-1';
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function toggleNotifications() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('hidden');
            updateNotificationList();
        }

        async function updateNotificationList() {
            const list = document.getElementById('notificationList');
            
            if (!currentProvider) {
                list.innerHTML = '<p class="text-gray-500 text-center">No notifications</p>';
                return;
            }

            try {
                const twoDaysAgo = new Date();
                twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
                const fourDaysAgo = new Date();
                fourDaysAgo.setDate(fourDaysAgo.getDate() - 4);

                const { data: pendingRequests, error } = await supabaseClient
                    .from('requests')
                    .select('*')
                    .eq('status', 'Pending');

                if (error) throw error;

                const providerPincodes = currentProvider.pincodes.split(',').map(p => p.trim());
                const providerCategories = currentProvider.categories.split(',').map(c => c.trim());

                const relevantRequests = pendingRequests.filter(request => {
                    return providerPincodes.includes(request.pincode) && 
                           providerCategories.includes(request.category) &&
                           (request.provider === 'default' || request.provider.includes(currentProvider.email));
                });

                const warningRequests = relevantRequests.filter(r => {
                    const requestDate = new Date(r.created_at);
                    return requestDate < twoDaysAgo && requestDate >= fourDaysAgo;
                });
                
                const criticalRequests = relevantRequests.filter(r => new Date(r.created_at) < fourDaysAgo);

                list.innerHTML = '';
                
                if (criticalRequests.length > 0) {
                    criticalRequests.forEach(request => {
                        const days = Math.floor((new Date() - new Date(request.created_at)) / (1000 * 60 * 60 * 24));
                        const notificationDiv = document.createElement('div');
                        notificationDiv.className = 'p-3 border-l-4 border-red-500 bg-red-50 rounded mb-2';
                        notificationDiv.innerHTML = `
                            <h4 class="font-medium text-red-800">Critical: Request #${request.request_id}</h4>
                            <p class="text-sm text-red-700">${request.category} - ${days} days old</p>
                            <p class="text-xs text-red-600">Customer: ${request.customer_name}</p>
                        `;
                        list.appendChild(notificationDiv);
                    });
                }
                
                if (warningRequests.length > 0) {
                    warningRequests.forEach(request => {
                        const days = Math.floor((new Date() - new Date(request.created_at)) / (1000 * 60 * 60 * 24));
                        const notificationDiv = document.createElement('div');
                        notificationDiv.className = 'p-3 border-l-4 border-yellow-500 bg-yellow-50 rounded mb-2';
                        notificationDiv.innerHTML = `
                            <h4 class="font-medium text-yellow-800">Warning: Request #${request.request_id}</h4>
                            <p class="text-sm text-yellow-700">${request.category} - ${days} days old</p>
                            <p class="text-xs text-yellow-600">Customer: ${request.customer_name}</p>
                        `;
                        list.appendChild(notificationDiv);
                    });
                }
                
                if (criticalRequests.length === 0 && warningRequests.length === 0) {
                    list.innerHTML = '<p class="text-gray-500 text-center">No notifications</p>';
                }
                
            } catch (error) {
                console.error('Error loading notifications:', error);
                list.innerHTML = '<p class="text-red-500 text-center">Error loading notifications</p>';
            }
        }

        function showProviderWarning(requestCount, type) {
            const warningDiv = document.createElement('div');
            const bgColor = type === 'critical' ? 'bg-red-500' : 'bg-yellow-500';
            const message = type === 'critical' ? 
                `Critical! You have ${requestCount} request(s) older than 4 days.` :
                `Warning! You have ${requestCount} request(s) older than 2 days.`;
            
            warningDiv.className = `fixed top-4 right-4 ${bgColor} text-white p-4 rounded-lg shadow-lg z-50 max-w-sm`;
            warningDiv.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle mr-3"></i>
                    <div>
                        <h4 class="font-semibold">${type === 'critical' ? 'Critical!' : 'Warning!'}</h4>
                        <p class="text-sm">${message}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(warningDiv);
            
            setTimeout(() => {
                if (warningDiv.parentElement) {
                    warningDiv.remove();
                }
            }, 10000);
        }

        function showDeactivationWarning() {
            const warningDiv = document.createElement('div');
            warningDiv.className = 'fixed top-4 right-4 bg-red-600 text-white p-4 rounded-lg shadow-lg z-50 max-w-sm';
            warningDiv.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-ban mr-3"></i>
                    <div>
                        <h4 class="font-semibold">Account Deactivation Warning!</h4>
                        <p class="text-sm">Your account may be deactivated due to multiple unresponded requests. Please contact support.</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(warningDiv);
        }

        // Premium Modal Functions
        function showSuccessModal(title, message) {
            document.getElementById('modalIcon').innerHTML = '<i class="fas fa-check text-white text-2xl"></i>';
            document.getElementById('modalIcon').className = 'w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-gradient-to-r from-green-400 to-emerald-500';
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modalButtons').innerHTML = '<button onclick="closePremiumModal()" class="btn-premium w-full">Continue</button>';
            document.getElementById('premiumModal').classList.remove('hidden');
        }
        
        function showDeclineModal(title, message) {
            document.getElementById('modalIcon').innerHTML = '<i class="fas fa-times text-white text-2xl"></i>';
            document.getElementById('modalIcon').className = 'w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-gradient-to-r from-orange-400 to-red-500';
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modalButtons').innerHTML = '<button onclick="closePremiumModal()" class="btn-premium w-full">Understood</button>';
            document.getElementById('premiumModal').classList.remove('hidden');
        }
        
        function showCancelModal(title, message) {
            document.getElementById('modalIcon').innerHTML = '<i class="fas fa-ban text-white text-2xl"></i>';
            document.getElementById('modalIcon').className = 'w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-gradient-to-r from-gray-400 to-gray-600';
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modalButtons').innerHTML = '<button onclick="closePremiumModal()" class="btn-premium w-full">Close</button>';
            document.getElementById('premiumModal').classList.remove('hidden');
        }
        
        function showErrorModal(title, message) {
            document.getElementById('modalIcon').innerHTML = '<i class="fas fa-exclamation-triangle text-white text-2xl"></i>';
            document.getElementById('modalIcon').className = 'w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-gradient-to-r from-red-400 to-pink-500';
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modalButtons').innerHTML = '<button onclick="closePremiumModal()" class="btn-premium w-full">Try Again</button>';
            document.getElementById('premiumModal').classList.remove('hidden');
        }
        
        function showConfirmModal(title, message, onConfirm) {
            document.getElementById('modalIcon').innerHTML = '<i class="fas fa-question text-white text-2xl"></i>';
            document.getElementById('modalIcon').className = 'w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-gradient-to-r from-blue-400 to-indigo-500';
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modalButtons').innerHTML = `
                <button onclick="confirmAction()" class="btn-premium w-full mb-2">Yes, Confirm</button>
                <button onclick="closePremiumModal()" class="w-full py-3 bg-gray-200 text-gray-800 rounded-xl font-semibold hover:bg-gray-300 transition-colors">Cancel</button>
            `;
            window.currentConfirmAction = onConfirm;
            document.getElementById('premiumModal').classList.remove('hidden');
        }
        
        function confirmAction() {
            if (window.currentConfirmAction) {
                window.currentConfirmAction();
                window.currentConfirmAction = null;
            }
            closePremiumModal();
        }
        
        function closePremiumModal() {
            document.getElementById('premiumModal').classList.add('hidden');
        }

        function logout() {
            if (unsubscribeChat) {
                unsubscribeChat();
            }
            isLoggedIn = false;
            currentProvider = null;
            localStorage.removeItem('providerLoggedIn');
            localStorage.removeItem('providerData');
            showAuth();
        }
    </script>
</body>
</html>
